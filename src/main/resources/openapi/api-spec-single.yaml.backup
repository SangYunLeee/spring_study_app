openapi: 3.0.1
info:
  title: 사용자 관리 API
  description: |
    # 명세 우선 개발 (Spec-First Development)

    이 명세가 코드보다 먼저 작성되었습니다.
    - 명세 작성 → 검토 → 합의 → 코드 자동 생성

    ## 주요 기능
    - 사용자 CRUD (생성, 조회, 수정, 삭제)
    - 검색 및 필터링
    - 통계
  version: 1.0.0
  contact:
    name: 학습자
    email: learner@example.com
  license:
    name: MIT License
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: 로컬 개발 서버

tags:
  - name: users
    description: 사용자 관리 API

paths:
  /api/users:
    post:
      tags:
        - users
      summary: 사용자 생성
      description: |
        새로운 사용자를 생성합니다.

        **제약사항:**
        - 이메일은 중복될 수 없습니다
        - 나이는 0 이상이어야 합니다
      operationId: createUser
      requestBody:
        description: 생성할 사용자 정보
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            examples:
              example1:
                summary: 일반 사용자 생성
                value:
                  name: 홍길동
                  email: hong@example.com
                  age: 25
      responses:
        '201':
          description: 사용자 생성 성공
          headers:
            Location:
              description: 생성된 리소스 URI
              schema:
                type: string
                example: /api/users/1
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: 잘못된 요청 (중복 이메일, 유효성 검증 실패 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      tags:
        - users
      summary: 전체 사용자 조회
      description: 시스템에 등록된 모든 사용자를 조회합니다.
      operationId: getAllUsers
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /api/users/{id}:
    get:
      tags:
        - users
      summary: ID로 사용자 조회
      description: 특정 ID의 사용자를 조회합니다.
      operationId: getUserById
      parameters:
        - name: id
          in: path
          description: 사용자 ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          description: 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      tags:
        - users
      summary: 사용자 전체 정보 수정
      description: |
        사용자의 모든 정보를 수정합니다.
        모든 필드가 필수입니다.
      operationId: updateUser
      parameters:
        - name: id
          in: path
          description: 사용자 ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1
      requestBody:
        description: 수정할 사용자 정보 (모든 필드 필수)
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: 잘못된 요청
        '404':
          description: 사용자를 찾을 수 없음

    patch:
      tags:
        - users
      summary: 사용자 부분 정보 수정
      description: |
        사용자의 일부 정보만 수정합니다.
        변경할 필드만 제공하면 됩니다.
      operationId: patchUser
      parameters:
        - name: id
          in: path
          description: 사용자 ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1
      requestBody:
        description: 수정할 필드 (모든 필드 선택적)
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PatchUserRequest'
            examples:
              ageOnly:
                summary: 나이만 수정
                value:
                  age: 26
              nameAndEmail:
                summary: 이름과 이메일 수정
                value:
                  name: 김철수
                  email: kim@example.com
      responses:
        '200':
          description: 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '400':
          description: 잘못된 요청 (필드가 하나도 없음)
        '404':
          description: 사용자를 찾을 수 없음

    delete:
      tags:
        - users
      summary: 사용자 삭제
      description: 특정 사용자를 시스템에서 삭제합니다.
      operationId: deleteUser
      parameters:
        - name: id
          in: path
          description: 사용자 ID
          required: true
          schema:
            type: integer
            format: int64
            example: 1
      responses:
        '204':
          description: 삭제 성공 (응답 본문 없음)
        '404':
          description: 사용자를 찾을 수 없음

  /api/users/search:
    get:
      tags:
        - users
      summary: 이름으로 사용자 검색
      description: 이름에 특정 키워드가 포함된 사용자를 검색합니다.
      operationId: searchUsers
      parameters:
        - name: keyword
          in: query
          description: 검색 키워드
          required: true
          schema:
            type: string
            example: 홍
      responses:
        '200':
          description: 검색 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /api/users/adults:
    get:
      tags:
        - users
      summary: 성인 사용자만 조회
      description: 나이가 19세 이상인 사용자만 조회합니다.
      operationId: getAdultUsers
      responses:
        '200':
          description: 조회 성공
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserResponse'

  /api/users/statistics:
    get:
      tags:
        - users
      summary: 사용자 통계 조회
      description: |
        전체 사용자에 대한 통계 정보를 조회합니다.
        - 전체 사용자 수
        - 성인 사용자 수
        - 평균 나이
        - 최소/최대 나이
      operationId: getUserStatistics
      responses:
        '200':
          description: 통계 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserStatistics'

components:
  schemas:
    CreateUserRequest:
      type: object
      description: 사용자 생성 요청
      required:
        - name
        - email
        - age
      properties:
        name:
          type: string
          description: 사용자 이름
          example: 홍길동
          minLength: 1
        email:
          type: string
          description: 이메일 주소 (중복 불가)
          format: email
          example: hong@example.com
        age:
          type: integer
          description: 나이
          format: int32
          minimum: 0
          maximum: 150
          example: 25

    UpdateUserRequest:
      type: object
      description: 사용자 전체 수정 요청 (모든 필드 필수)
      required:
        - name
        - email
        - age
      properties:
        name:
          type: string
          description: 사용자 이름
          example: 김철수
          minLength: 1
        email:
          type: string
          description: 이메일 주소
          format: email
          example: kim@example.com
        age:
          type: integer
          description: 나이
          format: int32
          minimum: 0
          maximum: 150
          example: 30

    PatchUserRequest:
      type: object
      description: 사용자 부분 수정 요청 (모든 필드 선택적)
      properties:
        name:
          type: string
          description: 사용자 이름
          example: 이영희
          minLength: 1
        email:
          type: string
          description: 이메일 주소
          format: email
          example: lee@example.com
        age:
          type: integer
          description: 나이
          format: int32
          minimum: 0
          maximum: 150
          example: 28

    UserResponse:
      type: object
      description: 사용자 응답 (조회, 생성, 수정 시 반환)
      required:
        - id
        - name
        - email
        - age
      properties:
        id:
          type: integer
          description: 사용자 고유 ID
          format: int64
          example: 1
        name:
          type: string
          description: 사용자 이름
          example: 홍길동
        email:
          type: string
          description: 이메일 주소
          example: hong@example.com
        age:
          type: integer
          description: 나이
          format: int32
          example: 25

    UserStatistics:
      type: object
      description: 사용자 통계 정보
      required:
        - totalCount
        - adultCount
        - averageAge
        - minAge
        - maxAge
      properties:
        totalCount:
          type: integer
          description: 전체 사용자 수
          format: int64
          example: 10
        adultCount:
          type: integer
          description: 성인 사용자 수
          format: int64
          example: 7
        averageAge:
          type: number
          description: 평균 나이
          format: double
          example: 28.5
        minAge:
          type: integer
          description: 최소 나이
          format: int32
          example: 17
        maxAge:
          type: integer
          description: 최대 나이
          format: int32
          example: 45

    ErrorResponse:
      type: object
      description: 에러 응답
      properties:
        message:
          type: string
          description: 에러 메시지
          example: User not found
        timestamp:
          type: string
          description: 에러 발생 시각
          format: date-time